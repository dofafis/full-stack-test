FROM node:10

# Create app directory
WORKDIR /catalog_api

# Install app dependencies
# A wildcard is used to ensure both package.json AND package-lock.json are copied
# where available (npm@5+)
COPY package*.json ./

ARG PORT
ARG MONGODB_USER
ARG MONGODB_PASSWORD
ARG MONGODB_HOST
ARG MONGODB_PORT
ARG MONGODB_DBNAME
ARG INSERT_PRODUCTS
ARG REDIS_PORT
ARG REDIS_HOST
ARG REDIS_PASSWORD

ENV PORT ${PORT}
ENV MONGODB_USER ${MONGODB_USER}
ENV MONGODB_PASSWORD ${MONGODB_PASSWORD}
ENV MONGODB_HOST ${MONGODB_HOST}
ENV MONGODB_PORT ${MONGODB_PORT}
ENV MONGODB_DBNAME ${MONGODB_DBNAME}
ENV INSERT_PRODUCTS ${INSERT_PRODUCTS}
ENV REDIS_PORT ${REDIS_PORT}
ENV REDIS_HOST ${REDIS_HOST}
ENV REDIS_PASSWORD ${REDIS_PASSWORD}

RUN npm install

# If you are building your code for production
# RUN npm ci --only=production

# Bundle app source
COPY . .

EXPOSE ${PORT}
CMD PORT=${PORT} \
MONGODB_DBNAME=${MONGODB_DBNAME} MONGODB_HOST=${MONGODB_HOST} MONGODB_PASSWORD=${MONGODB_PASSWORD} MONGODB_USER=${MONGODB_USER} \
INSERT_PRODUCTS=${INSERT_PRODUCTS} \
REDIS_PORT=${REDIS_PORT} REDIS_HOST=${REDIS_HOST} REDIS_PASSWORD=${REDIS_PASSWORD} \
node index.js