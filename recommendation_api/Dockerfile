FROM node:10

WORKDIR /recommendation_api

COPY package*.json ./

ARG PORT
ARG REDIS_PORT
ARG REDIS_HOST
ARG REDIS_PASSWORD
ARG CATALOG_API_URL
ARG RANKING_API_URL

ENV PORT ${PORT}
ENV REDIS_PORT ${REDIS_PORT}
ENV REDIS_HOST ${REDIS_HOST}
ENV REDIS_PASSWORD ${REDIS_PASSWORD}
ENV CATALOG_API_URL ${CATALOG_API_URL}
ENV RANKING_API_URL ${RANKING_API_URL}

RUN npm install

COPY . .

EXPOSE ${PORT}
CMD PORT=${PORT} \
REDIS_PORT=${REDIS_PORT} REDIS_HOST=${REDIS_HOST} REDIS_PASSWORD=${REDIS_PASSWORD} \
CATALOG_API_URL=${CATALOG_API_URL} RANKING_API_URL=${RANKING_API_URL} \
node index.js